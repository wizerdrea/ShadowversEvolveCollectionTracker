<UserControl x:Class="ShadowverseEvolveCardTracker.Views.SetCompletionTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:ShadowverseEvolveCardTracker.Converters"
             Background="{DynamicResource PrimaryBrush}">
    <UserControl.Resources>
        <conv:PercentageToGoldBrushConverter x:Key="PercentToGoldConverter" />
    </UserControl.Resources>

    <Grid Margin="8">
        <DataGrid ItemsSource="{Binding SetsView}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  CanUserAddRows="False"
                  Background="{DynamicResource PrimaryBrush}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Set Name" Binding="{Binding SetName}" Width="2*" />

                <!-- 1 Card Set % as templated cell so we can overlay gradient + glow animation -->
                <DataGridTemplateColumn Header="1 Card Set %" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <Border x:Name="HighlightBorder"
                                        CornerRadius="4"
                                        Padding="4,2"
                                        Background="{Binding OneCardPercent, Converter={StaticResource PercentToGoldConverter}}"
                                        BorderBrush="Transparent"
                                        BorderThickness="1">


                                    <TextBlock Text="{Binding OneCardPercent, StringFormat={}{0}%}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Playset % templated similarly -->
                <DataGridTemplateColumn Header="Playset %" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <Border x:Name="PlaysetBorder"
                                        CornerRadius="4"
                                        Padding="4,2"
                                        Background="{Binding PlaysetPercent, Converter={StaticResource PercentToGoldConverter}}"
                                        BorderBrush="Transparent"
                                        BorderThickness="1">
                                    <Border.Effect>
                                        <DropShadowEffect Color="#FFD4AF37"
                                                          BlurRadius="4"
                                                          Opacity="0.0"
                                                          ShadowDepth="0"/>
                                    </Border.Effect>

                                    <TextBlock Text="{Binding PlaysetPercent, StringFormat={}{0}%}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                </Border>
                            </Grid>

                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding PlaysetPercent}" Value="100">
                                    <Setter TargetName="PlaysetBorder" Property="BorderBrush" Value="{DynamicResource GoldBrush}" />
                                    <Setter TargetName="PlaysetBorder" Property="BorderThickness" Value="2" />

                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="PlaysetGlow">
                                            <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                <DoubleAnimation Storyboard.TargetName="PlaysetBorder"
                                                                 Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.BlurRadius)"
                                                                 From="6" To="18" Duration="0:0:0.9" />
                                                <DoubleAnimation Storyboard.TargetName="PlaysetBorder"
                                                                 Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.Opacity)"
                                                                 From="0.45" To="1.0" Duration="0:0:0.9" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>

                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="PlaysetGlow" />
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="PlaysetBorder"
                                                                 Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.Opacity)"
                                                                 To="0.0" Duration="0:0:0.15" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>

            <DataGrid.Style>
                <Style TargetType="DataGrid">
                    <Setter Property="RowHeight" Value="28"/>
                </Style>
            </DataGrid.Style>
        </DataGrid>

        <TextBlock Text="No set data available. Load cards to populate set completion."
                   Foreground="{DynamicResource TextSecondaryBrush}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   TextWrapping="Wrap"
                   TextAlignment="Center"
                   Width="380">
            <TextBlock.Style>
                <Style TargetType="TextBlock">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding SetsView.IsEmpty}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>
        </TextBlock>
    </Grid>
</UserControl>