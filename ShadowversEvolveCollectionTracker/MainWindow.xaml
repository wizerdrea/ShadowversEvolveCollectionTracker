<Window x:Class="ShadowverseEvolveCardTracker.MainWindow"
        x:Name="RootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:ShadowverseEvolveCardTracker.Views"
        Title="Shadowverse Evolve Card Tracker" 
        Height="800" Width="1400"
        Background="{DynamicResource PrimaryBrush}"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      ResizeBorderThickness="5"
                      CornerRadius="0"
                      GlassFrameThickness="0"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Border BorderBrush="{DynamicResource AccentBrush}" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource ElevatedBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="0,0,0,1"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- App Title with Custom Icon -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="8,0,0,0">
                        <!-- Custom Card-to-Smoke Icon -->
                        <Viewbox Width="20" Height="20" Margin="0,0,8,0">
                            <Canvas Width="24" Height="24">
                                <!-- Card base -->
                                <Rectangle Width="14" Height="20" Canvas.Left="5" Canvas.Top="2"
                                           RadiusX="1" RadiusY="1">
                                    <Rectangle.Fill>
                                        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                            <GradientStop Color="{StaticResource ColorAccent}" Offset="0"/>
                                            <GradientStop Color="{StaticResource ColorAccentLight}" Offset="0.3"/>
                                            <GradientStop Color="{StaticResource ColorAccent40}" Offset="0.7"/>
                                            <GradientStop Color="{StaticResource ColorAccent00}" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Rectangle.Fill>
                                </Rectangle>

                                <!-- Smoke particles at bottom -->
                                <Ellipse Width="3" Height="3" Canvas.Left="6" Canvas.Top="19" 
                                         Fill="{StaticResource AccentLight60Brush}" Opacity="0.6"/>
                                <Ellipse Width="4" Height="4" Canvas.Left="10" Canvas.Top="20" 
                                         Fill="{StaticResource AccentLight40Brush}" Opacity="0.5"/>
                                <Ellipse Width="3" Height="3" Canvas.Left="15" Canvas.Top="19" 
                                         Fill="{StaticResource AccentLight60Brush}" Opacity="0.6"/>
                                <Ellipse Width="2" Height="2" Canvas.Left="8" Canvas.Top="21" 
                                         Fill="{StaticResource AccentLight30Brush}" Opacity="0.4"/>
                                <Ellipse Width="2" Height="2" Canvas.Left="16" Canvas.Top="21" 
                                         Fill="{StaticResource AccentLight30Brush}" Opacity="0.4"/>


                                <!-- Smoke particles at top -->
                                <Ellipse Width="2" Height="2" Canvas.Left="7" Canvas.Top="1" 
                                         Fill="{StaticResource Gold50Brush}" Opacity="0.5"/>
                                <Ellipse Width="3" Height="3" Canvas.Left="11" Canvas.Top="0" 
                                         Fill="{StaticResource Gold40Brush}" Opacity="0.4"/>
                                <Ellipse Width="2" Height="2" Canvas.Left="15" Canvas.Top="1" 
                                         Fill="{StaticResource Gold50Brush}" Opacity="0.5"/>
                            </Canvas>
                        </Viewbox>

                        <TextBlock Text="Shadowverse Evolve Card Tracker" 
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource GoldBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Window Control Buttons -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <!-- Minimize Button -->
                        <Button Width="46" Height="32"
                                Click="MinimizeButton_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                Margin="0"
                                ToolTip="Minimize"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}">
                                                    <Path Data="M 0,0 H 10" 
                                                          Stroke="{TemplateBinding Foreground}"
                                                          StrokeThickness="1"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                                            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!-- Maximize/Restore Button -->
                        <Button x:Name="MaximizeRestoreButton"
                                Width="46" Height="32"
                                Click="MaximizeRestoreButton_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                Margin="0"
                                ToolTip="Maximize"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}">
                                                    <Path x:Name="MaximizeRestorePath"
                                                          Data="M 0,0 H 10 V 10 H 0 Z M 0,2 H 10" 
                                                          Stroke="{TemplateBinding Foreground}"
                                                          StrokeThickness="1"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                                            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!-- Close Button -->
                        <Button Width="46" Height="32"
                                Click="CloseButton_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                Margin="0"
                                ToolTip="Close"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}">
                                                    <Path Data="M 0,0 L 10,10 M 10,0 L 0,10" 
                                                          Stroke="{TemplateBinding Foreground}"
                                                          StrokeThickness="1"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#E81123"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <DockPanel Grid.Row="1" Margin="8" Background="{DynamicResource PrimaryBrush}">
                <TextBlock Text="{Binding Status}" 
                           DockPanel.Dock="Bottom" 
                           Margin="0,8,0,0" 
                           x:Name="StatusTextBlock"
                           Foreground="{DynamicResource AccentBrush}"
                           FontStyle="Italic" />

                <!-- Menu bar -->
                <Menu DockPanel.Dock="Top" Background="{DynamicResource ElevatedBrush}" Foreground="{DynamicResource TextPrimaryBrush}">
                    <MenuItem Header="_File">
                        <MenuItem Header="Select Folder and Load..." 
                                  Command="{Binding LoadFolderCommand}"
                                  InputGestureText="Ctrl+O"/>
                        <MenuItem Header="Load Images" 
                                  Command="{Binding LoadImagesCommand}"
                                  InputGestureText="Ctrl+I"/>
                        <Separator/>
                        <MenuItem Header="_Save" 
                                  Command="{Binding SaveCommand}"
                                  InputGestureText="Ctrl+S"/>
                        <Separator/>
                        <MenuItem Header="E_xit" Click="CloseButton_Click"/>
                    </MenuItem>
                    <MenuItem Header="_Tools">
                        <MenuItem Header="Find Card Relations" 
                                  Command="{Binding FindCardRelationsCommand}"
                                  InputGestureText="Ctrl+R"
                                  ToolTip="Analyze all cards and find relationships between them"/>
                    </MenuItem>
                </Menu>

                <!-- TabControl with UserControls -->
                <TabControl Background="{DynamicResource PrimaryBrush}" Margin="0,8,0,0">
                    <TabItem Header="All Cards">
                        <views:AllCardsTabView DataContext="{Binding AllCardsTab}" />
                    </TabItem>

                    <TabItem Header="Checklist">
                        <views:ChecklistTabView DataContext="{Binding ChecklistTab}" />
                    </TabItem>

                    <TabItem Header="Set Completion">
                        <views:SetCompletionTabView DataContext="{Binding SetCompletionTab}" />
                    </TabItem>

                    <TabItem Header="Deck Builder">
                        <views:DeckBuilderTabView DataContext="{Binding DeckBuilderTab}"/>
                    </TabItem>
                </TabControl>
            </DockPanel>
        </Grid>
    </Border>
</Window>