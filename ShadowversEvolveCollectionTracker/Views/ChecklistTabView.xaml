<UserControl x:Class="ShadowversEvolveCardTracker.Views.ChecklistTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:ShadowversEvolveCardTracker.Converters"
             xmlns:controls="clr-namespace:ShadowversEvolveCardTracker.Controls"
             Background="{DynamicResource PrimaryBrush}">
    
    <UserControl.Resources>
        <conv:StringToImageSourceConverter x:Key="StringToImageConverter" />
        <conv:TotalQuantityToCategoryConverter x:Key="TotalQuantityToCategoryConverter" />
    </UserControl.Resources>
    
    <Grid Margin="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="6" />
            <ColumnDefinition Width="320" MinWidth="200" />
        </Grid.ColumnDefinitions>

        <!-- Wrap the DataGrid in a Grid so we can overlay a "calculating" message -->
        <Grid Grid.Column="0">
            <DataGrid ItemsSource="{Binding ChecklistView}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      SelectedItem="{Binding SelectedCombinedCard, Mode=TwoWay}"
                      Background="{DynamicResource PrimaryBrush}">
                <DataGrid.Columns>
                    <DataGridTextColumn Binding="{Binding Name}" Width="3*">
                        <DataGridTextColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="Card Name"/>
                                    <TextBox Text="{Binding DataContext.ChecklistNameFilter, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}" Width="200" ToolTip="Enter a regular expression to filter card names"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTextColumn.HeaderTemplate>
                    </DataGridTextColumn>

                    <DataGridTextColumn Binding="{Binding TotalQuantityOwned}" Width="*">
                        <DataGridTextColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="Total Qty"/>
                                    <ComboBox Width="120"
                                              SelectedValuePath="Content"
                                              SelectedValue="{Binding DataContext.ChecklistQtyFilter, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">
                                        <ComboBoxItem Content="Both" />
                                        <ComboBoxItem Content="Owned" />
                                        <ComboBoxItem Content="Unowned" />
                                    </ComboBox>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTextColumn.HeaderTemplate>

                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                <Setter Property="Background" Value="Transparent"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding TotalQuantityOwned, Converter={StaticResource TotalQuantityToCategoryConverter}}" Value="Low">
                                        <Setter Property="Background" Value="{DynamicResource ChecklistLowBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TotalQuantityOwned, Converter={StaticResource TotalQuantityToCategoryConverter}}" Value="High">
                                        <Setter Property="Background" Value="{DynamicResource ChecklistHighBrush}"/>
                                        <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Overlay message shown while calculating -->
            <TextBlock Text="{Binding DataContext.CalculatingMessage, RelativeSource={RelativeSource AncestorType=UserControl}}"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource GoldBrush}"
                       Background="{DynamicResource SurfaceBrush}"
                       Padding="12"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       TextAlignment="Center"
                       TextWrapping="Wrap"
                       MaxWidth="400">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding DataContext.IsCalculating, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </Grid>

        <GridSplitter Grid.Column="1"
                      Width="6"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Stretch"
                      ShowsPreview="True"
                      ResizeDirection="Columns"
                      Cursor="SizeWE"/>

        <controls:CardViewerControl Grid.Column="2"
                                    Margin="8,0,0,0"
                                    DataContext="{Binding CardViewer}"/>
    </Grid>
</UserControl>